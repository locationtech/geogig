<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, maximum-scale=1">
  
  <title>Binary encoding of GeoGig objects &mdash; GeoGig 1.0-beta1 Technical Manual</title>
  <link rel="stylesheet" href="_static/screen.css" type="text/css" media="screen, projection" />
  <link rel="stylesheet" href="_static/print.css" type="text/css" media="print" /> 
  <!--[if IE]>
  <link rel="stylesheet" href="_static/blueprint/ie.css" type="text/css" media="screen, projection" />
  <![endif]-->
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/offcanvas.css" type="text/css" />
  <script type="text/javascript">
    var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '1.0-beta1',
        COLLAPSE_MODINDEX: false,
        FILE_SUFFIX: '.html'
    };
  </script>
  <link rel="shortcut icon" href="_static/favicon.ico"/>
      <link rel="top" title="GeoGig 1.0-beta1 Technical Manual" href="index.html" />
      <link rel="next" title="GeoGig Network Synchronization" href="geogig-network-sync.html" />
      <link rel="prev" title="GeoGig Technical Manual" href="index.html" />
</head>
<body class="geogig-binary">
    <div id="blacktop"></div>
    <header id="masthead">
      <div class="navbar">
        <div class="container">
          <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="http://geogig.org"><h1>GeoGig</h1></a>
          </div>
          <div class="navbar-collapse collapse navbar-right">
            <ul class="nav navbar-nav">
              <li><a href="http://geogig.org/#install">Get Started</a></li>
              <li><a href="http://geogig.org/docs/index.html">Documentation</a></li>
              <li><a href="https://github.com/locationtech/geogig">On Github</a></li>
            </ul>
          </div><!--/.navbar-collapse -->
        </div>
      </div>
    </header>

    <section class="subheading hidden-xs">
      <div class="container">
        <div class="row">
          <div class="col-md-8">
            <p class="byline">A Tool for Geospatial Data Management</p>
          </div>
        </div>
      </div>
    </section>
    <a name="top"></a>

 <div id="main">
    <div class="wrap selfclear">
      <div id="content">
      <div class="container">
        <div class="row row-offcanvas row-offcanvas-right">
          <div class="col-md-8"> 
            <div class="row pull-right">
             <div class="visible-sm visible-xs" id="menu-btn">
                <button class="btn btn-blue btn-sm"type="button" data-toggle="offcanvas">
                  <span class="btn-text active">Menu &rarr;</span>
                  <span class="btn-back">&larr; Back</span>
                </button>
              </div>
            </div>
<ul id="breadcrumbs">
  
  <li><a href="index.html">GeoGig 1.0-beta1 Technical Manual</a> &raquo;</li>
  <li>Binary encoding of GeoGig objects</li>
</ul>
<ul id="relatedlinks" class="selfclear">
  <li class="first">
    <a href="genindex.html" title="General Index"
       accesskey="I">index</a></li>
  <li>
    <a href="geogig-network-sync.html" title="GeoGig Network Synchronization"
       accesskey="N">next</a>|</li>
  <li>
    <a href="index.html" title="GeoGig Technical Manual"
       accesskey="P">previous</a>|</li>
</ul>
        
  <div class="section" id="binary-encoding-of-geogig-objects">
<h1>Binary encoding of GeoGig objects<a class="headerlink" href="#binary-encoding-of-geogig-objects" title="Permalink to this headline">¶</a></h1>
<p>This is the format used for internal storage in the GeoGig object store.</p>
<div class="section" id="conventions">
<h2>Conventions<a class="headerlink" href="#conventions" title="Permalink to this headline">¶</a></h2>
<p>Formats are specified using a modified Backus-Naur notation.
Definitions generally take the form:</p>
<div class="highlight-python"><div class="highlight"><pre>&lt;structure&gt; := part1 part2 part3
</pre></div>
</div>
<p>Indicating that the structure has three parts.
The parts can be:</p>
<ul>
<li><p class="first">Another structure, referenced by name.</p>
</li>
<li><p class="first">One of these specially defined structures</p>
<div class="highlight-none"><div class="highlight"><pre>NUL       := 0x00 (ASCII NUL character)
SP        := 0x20 (ASCII space character)
BR        := 0x0a (ASCII newline character)
&lt;rev&gt;     := &lt;byte&gt;* (exactly 20 bytes)
&lt;utf8&gt;    := &lt;int16&gt; &lt;byte&gt;* (two-byte count followed by the number
                              of bytes indicated by the count.
                              These should then be decoded as
                              modified UTF-8, as seen in the
                              readUTF and writeUTF methods in the
                              java.io.DataInputStream and
                              java.io.DataOutputStream classes
                              in the Java Standard Library.)
&lt;byte&gt;    := (8 bit byte)
&lt;int16&gt;   := (16 bit signed integer, &quot;short&quot; in Java)
&lt;int32&gt;   := (32 bit signed integer, &quot;int&quot; in Java)
&lt;int64&gt;   := (64 bit signed integer, &quot;long&quot; in Java)
&lt;float32&gt; := (32 bit IEEE floating point value, &quot;float&quot; in Java)
&lt;float64&gt; := (64 bit IEEE floating point value, &quot;double&quot; in Java)
</pre></div>
</div>
</li>
<li><p class="first">A literal byte sequence.  These are generally used as markers and are represented as text in double quotes (<cite>&#8220;</cite>).
These markers will always be constrained to printable ASCII characters and should be encoded as ASCII, one byte per character.</p>
</li>
<li><p class="first">A literal byte, specified as a hexidecimal string (for example, 0xFF).</p>
</li>
<li><p class="first">any of the above suffixed by a modifier:</p>
<ul class="simple">
<li>An asterisk (<cite>*</cite>) to indicate 0 or more repetitions</li>
<li>A number in brackets (<cite>[]</cite>) to indicate a specific number of repetitions.</li>
</ul>
</li>
<li><p class="first">Comments sometimes appear to clarify the intent of certain structures.
These will be enclosed in parentheses (<cite>()</cite>).</p>
</li>
</ul>
</div>
<div class="section" id="commit">
<h2>Commit<a class="headerlink" href="#commit" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none"><div class="highlight"><pre>commit := commitHeader treeRef parent* authorLine committerLine message
commitHeader := &quot;commit&quot; NUL
treeRef := 0x01 &lt;rev&gt;
parent  := 0x02 &lt;rev&gt;
authorLine := 0x03 person
committerLine := 0x04 person
person := name email timestamp tzOffset
name := &lt;utf8&gt;
email := &lt;utf8&gt;
timestamp := &lt;int64&gt;
tzOffset := &lt;int32&gt;
message := &lt;utf8&gt;
</pre></div>
</div>
</div>
<div class="section" id="tree">
<h2>Tree<a class="headerlink" href="#tree" title="Permalink to this headline">¶</a></h2>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>In representing trees we split the count of tree contents into three fields:
features, trees, and buckets. Because of the way GeoGig builds trees,
buckets must be zero when either of the other two fields is nonzero.</p>
<p class="last">We should probably document how exactly GeoGig builds trees :)</p>
</div>
<div class="highlight-none"><div class="highlight"><pre>tree := treeHeader size treeCount features trees buckets
size := &lt;int64&gt; (the total [recursive] count of features in this tree)
treeCount := &lt;int32&gt; (in a bucket tree: the number of trees that are
                      direct children of the bucket tree. In a node
                      tree: 0)
features := count node*
trees := count node*
buckets := count bucket*
count := &lt;int32&gt;
node := name objectId metadataId envelope nodeType
name := &lt;utf8&gt;
objectId := &lt;byte&gt;[20]
metadataId := &lt;byte&gt;[20]
envelope := &lt;float64&gt;[4] (minx, maxx, miny, maxy.  Note that this may be
                         (0, -1, 0, -1) as is traditional for indicating
                         NULL envelopes. Of course empty (zero-area)
                         envelopes are valid as well.)
nodeType := &lt;byte&gt; (0x01: Tree, 0x02: Feature)
bucket := index objectId envelope
index := &lt;int32&gt;
</pre></div>
</div>
</div>
<div class="section" id="feature">
<h2>Feature<a class="headerlink" href="#feature" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none"><div class="highlight"><pre>feature := featureHeader count fields
featureHeader := &quot;feature&quot; NUL
count := &lt;int32&gt;
fields := field*
field = nullField |
        booleanField | byteField | shortField | intField | longField | floatField | doubleField | stringField |
        booleanArray | byteArray | shortArray | intArray | longArray | floatArray | doubleArray | stringArray |
        geometryField | uuidField | bigIntField | bigDecimalField
nullField               := 0x00
booleanField            := 0x01 &lt;byte&gt;
byteField               := 0x02 &lt;byte&gt;
shortField              := 0x03 &lt;int16&gt;
intField                := 0x04 &lt;int32&gt;
longField               := 0x05 &lt;int64&gt;
floatField              := 0x06 &lt;float32&gt;
doubleField             := 0x07 &lt;float64&gt;
stringField             := 0x08 &lt;utf8&gt;
booleanArray            := 0x09 &lt;int32&gt; &lt;byte&gt;* (note that the int is the number of boolean values and booleans are packed to save space. so the number of bytes is actually the count of bits divided by 8)
byteArray               := 0x0A &lt;int32&gt; &lt;byte&gt;*
shortArray              := 0x0B &lt;int32&gt; &lt;int16&gt;*
intArray                := 0x0C &lt;int32&gt; &lt;int32&gt;*
longArray               := 0x0D &lt;int32&gt; &lt;int64&gt;*
floatArray              := 0x0E &lt;int32&gt; &lt;float32&gt;*
doubleArray             := 0x0F &lt;int32&gt; &lt;float64&gt;*
stringArray             := 0x10 &lt;utf8&gt;
pointField              := 0x11 &lt;int32&gt; &lt;byte&gt;* (bytes represent the geometry encoded as Well-Known Binary)
lineStringField         := 0x12 &lt;int32&gt; &lt;byte&gt;* (same)
polygonField            := 0x13 &lt;int32&gt; &lt;byte&gt;* (same)
multiPointField         := 0x14 &lt;int32&gt; &lt;byte&gt;* (same)
multiLineStringField    := 0x15 &lt;int32&gt; &lt;byte&gt;* (same)
multiPolygonField       := 0x16 &lt;int32&gt; &lt;byte&gt;* (same)
geometryCollectionField := 0x17 &lt;int32&gt; &lt;byte&gt;* (same)
geometryField           := 0x18 &lt;int32&gt; &lt;byte&gt;* (same)
uuidField               := 0x19 &lt;int64&gt; &lt;int64&gt;
bigIntField             := 0x1A &lt;int32&gt; &lt;byte&gt;*
bigDecimalField         := 0x1B &lt;int32&gt; &lt;int32&gt; &lt;byte&gt;* (scale, length of byte array, byte array)
datetimeField           := 0x1C &lt;int64&gt; (milliseconds since unix epoch)
dateField               := 0x1D &lt;int64&gt; (datetime with hours, minutes, seconds, milliseconds all set to 0)
timeField               := 0x1E &lt;int64&gt; (datetime with years, months, days all set to zero (ie, a time on Jan 1 1970))
timestampField          := 0x1F &lt;int64&gt; &lt;int32&gt; (datetime followed by a specifier of nanoseconds within the millisecond)
</pre></div>
</div>
</div>
<div class="section" id="featuretype">
<h2>FeatureType<a class="headerlink" href="#featuretype" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none"><div class="highlight"><pre>featureType := featureTypeHeader name properties
featureTypeHeader := &quot;featuretype&quot; NUL
name := namespace localPart
namespace := &lt;utf8&gt;
localPart := &lt;utf8&gt;
properties := &lt;int32&gt; property*
property := name nillability minOccurs maxOccurs type
nillability := &lt;byte&gt; (0: non-nillable, 1: nillable. other values unused.)
minOccurs := &lt;int32&gt;
maxOccurs := &lt;int32&gt;
type := spatialType | aspatialType
aspatialType := name typeTag (aspatial types are distinguished from
                              spatial ones by the value of the type tag)
typeTag := &lt;byte&gt; (as used in features)
spatialType := name typeTag crsTextInterpretation crsText
crsTextInterpretation := &lt;byte&gt; (0: crsText is WKT CRS definition,
                                 1: crsText references a well-known CRS by
                                 identifier. If it uses URI notation
                                 (&quot;urn:...&quot;) then the axes should be
                                 forced to X=Easting, Y=Northing order.)
crsText := &lt;utf8&gt; (as determined by crsTextInterpretation)
</pre></div>
</div>
</div>
<div class="section" id="tag">
<h2>Tag<a class="headerlink" href="#tag" title="Permalink to this headline">¶</a></h2>
<div class="highlight-none"><div class="highlight"><pre>tag := tagHeader objectId tagName message tagger
tagHeader := &quot;tag&quot; NUL
objectId := &lt;byte&gt;[20]
tagName := &lt;utf8&gt;
message := &lt;utf8&gt;
tagger := name email timestamp tzOffset
name := &lt;utf8&gt;
email := &lt;utf8&gt;
timestamp := &lt;int64&gt;
tzOffset := &lt;int32&gt;
</pre></div>
</div>
</div>
</div>


      <div class="selfclear pagination-nav">
          <div class="leftwise"><strong>Previous</strong>: <a href="index.html" title="previous chapter">GeoGig Technical Manual</a></div>
          <div class="rightwise"><strong>Next</strong>: <a href="geogig-network-sync.html" title="next chapter">GeoGig Network Synchronization</a></div>
      </div>
      <p class="centered-text"><a href="#top"><img src="_static/arrow_up.png" alt="back to top"/></a></p>
      </div><!-- /#content> -->
  <div id="sidebar" class="sidebar-offcanvas contrast col-sm-4 sidebar-offcanvas" id="sidebar" role="navigation">

    <div>
         <form id="quick-search" action="search.html" method="get" style="width: 100%;">
          <fieldset>
            <input type="hidden" name="check_keywords" value="yes" />
            <input type="hidden" name="area" value="default" />
            <input id="quick-search-query" type="text" name="q" accessKey="q" name="searchQuery.queryString" size="25" value="Search Documentation&hellip;" size="20" tabindex="3" onblur="if(this.value=='') this.value='Search Documentation&hellip;';" onfocus="if(this.value=='Search Documentation&hellip;') this.value='';" />
          </fieldset>
        </form>


        <div class="btn-group-vertical" id="docs_toc"> 
          <button type="button" class="btn btn-default"><a href="/docs/">User Manual</a></button>
          <button type="button" class="btn btn-default"><a href="/technical/">Technical Manual</a></button>
          <button type="button" class="btn btn-default"><a href="/manpages/">Man Pages</a></button>
          <button type="button" class="btn btn-default"><a href="/workshop/">Workshop</a></button>
      </div>
      <h3 class="pngfix">Table Of Contents</h3>
        <ul>
<li><a class="reference internal" href="#">Binary encoding of GeoGig objects</a><ul>
<li><a class="reference internal" href="#conventions">Conventions</a></li>
<li><a class="reference internal" href="#commit">Commit</a></li>
<li><a class="reference internal" href="#tree">Tree</a></li>
<li><a class="reference internal" href="#feature">Feature</a></li>
<li><a class="reference internal" href="#featuretype">FeatureType</a></li>
<li><a class="reference internal" href="#tag">Tag</a></li>
</ul>
</li>
</ul>

        <div class="section-footer"></div>
      </div>
        <div class="section continue_reading">
          <h3>Continue Reading</h3>
          <ul>
            <li>Previous: <a href="index.html" title="previous chapter">GeoGig Technical Manual</a></li>
            <li>Next: <a href="geogig-network-sync.html" title="next chapter">GeoGig Network Synchronization</a></li>
          </ul>
        </div>
        <div class="section">
        <h3>This Page</h3>
        <ul class="this-page-menu">
          <li><a href="_sources/geogig-binary.txt">Show Source</a></li>
        </ul>
        </div>
        <div class="section">
          <h3>License</h3>
          <p>This project is licensed under the <a href="https://github.com/locationtech/geogig/blob/master/LICENSE.txt">BSD New License</a>.</p>
        </div>

  </div><!-- /#sidebar -->
  </div><!-- /.wrap> -->
</div>
</div>

</div><!-- /#main -->
    <footer>
      <div class="container">
        <div class="row">
          <div class=""><p class="repo-owner"><a href="https://github.com/locationtech/geogig">GeoGig</a> is maintained by <a href="https://github.com/boundlessgeo"><img src="_static/Boundless_Logo.png" alt="Boundless"></a></p></div>
        </div>
      </div>
    </footer>


  <script type="text/javascript" src="_static/jquery.js"></script>
  <script type="text/javascript" src="_static/jquery-migrate-min.js"></script>
  <script type="text/javascript" src="_static/bootstrap.js" ></script>
  <script type="text/javascript" src="_static/underscore.js"></script>
  <script type="text/javascript" src="_static/doctools.js"></script>
  <script type="text/javascript" src="_static/searchtools.js"></script>
  <script type="text/javascript" src="searchindex.js"></script>
  <script>
      $(document).ready(function() {

      $('[data-toggle=offcanvas]').click(function(e) {
        e.stopPropagation();
        $('.row-offcanvas').toggleClass('active');
        $('.btn-back').toggleClass('active');
        $('.btn-text').toggleClass('active');
      });
      $('.list-group-item').click(function(e) {
        e.stopPropagation();
        $('.row-offcanvas').toggleClass('active');
        $('.btn-back').toggleClass('active');
        $('.btn-text').toggleClass('active');
      });
    });
  </script>
  <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-3879903-19']);
      _gaq.push(['_trackPageview']);
      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
  </script>
  </body>
</html>
